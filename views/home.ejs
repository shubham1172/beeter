<!-- views/home.ejs -->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Beeter!</title>
    <link rel="stylesheet" href="/css/bulma.min.css">
    <link rel="stylesheet" href="/css/index.css">
    <script defer src="/js/fontawesome.js"></script>
    <script defer src="/js/home.js"></script>
    <%
      function getTimeDifference(date){
        var curr = new Date()
        var old = new Date(date)
        diff = (curr.getTime() - old.getTime())/(60*1000)
        if (diff/60 > 1)
            return Math.round(diff/60) + "h"
        else
            return Math.round(diff) + "m"
      }
      %>
  </head>
  <body>
  <header>
      <% include partials/header %>
  </header>
  <section class="section" style="background-color:#e1e6ee;padding:0">
    <div class="container">
        <div class="columns is-gapless">
            <div class="column is-one-quarter">
                <div class="tile is-child box">
                    <p class="title is-size-5"><%= user.name %></p>
                    <p class="subtitle is-size-6"> @<%= user.username %></p>
                    <div class="has-text-danger">
                        <%= error %>
                    </div>
                    <form action="/logout" method="get">
                      <input type="submit" class="button is-info " value="Logout" name="Submit"/>
                    </form>
                </div>
            </div>
            <div class="column">
                <div class="box">
                    <article>
                      <div class="content">  
                        <form action="/beets" method="post">
                          <div class="field">
                              <p class="control">
                                <textarea class="textarea" name="content" 
                                placeholder="What's happening?" rows="1" 
                                onfocus="textAreaOnFocus(this)"
                                onblur="textAreaOnBlur(this)" ></textarea>
                              </p>
                              <input id="beet_button" type="submit" class="button is-info" 
                              style="display:none" value="Beet" name="Submit"/>
                          </div>
                        </form>
                      </div>
                    </article>
                </div>               
                <div class="tile is-child box" id="beets_div">
                  <% %>
                  <% for(var i=0; i<beets.length; i++) {%>
                      <div class="box">
                          <article>
                            <div class="content">
                              <div class="content">
                                <p>
                                  <strong><%= beets[i].author.name %></strong>
                                  <small>
                                  <a href="/users/<%= beets[i].author.username %>">
                                      @<%= beets[i].author.username %>
                                  </a>
                                  </small>
                                  <small><%= getTimeDifference(beets[i].timestamp) %></small>
                                  <br>
                                  <%= beets[i].content %>
                                </p>
                              </div>
                              <nav class="level is-mobile">
                                <div class="level-left">
                                  <a class="level-item" aria-label="like">
                                    <span id="<%=beets[i]._id%>_like_icon" class="icon is-small" onclick="likePressed(this)">
                                      <% var flag = false;
                                         for (var j=0; j<beets[i].likes.length; j++) {
                                           if (beets[i].likes[j].username == user.username)
                                              flag = true
                                          }
                                         if (flag) { %>
                                        <i class="fas fa-heart" aria-hidden="true"></i>  
                                      <% } else { %>
                                        <i class="far fa-heart" aria-hidden="true"></i>
                                      <% } %>
                                    </span>
                                  </a>
                                  <small id="<%=beets[i]._id%>_like_count"><%= beets[i].likes.length %></small>
                                </div>
                              </nav>
                            </div>
                          </article>
                        </div>
                  <% } %>
                </div>
              </div>
        </div>    
    </div>
  </section>
  <footer>
      <% include partials/footer %>
  </footer>
  </body>
</html>